<llpackages>
	<package name="teamviewer" />
	<scripts>
		<scriptdata location="/etc/sudoers.lax.d/teamviewer" mode="0440" group="0" owner="0">
		<![CDATA[
surfer  ALL = NOPASSWD: /usr/bin/teamviewer.sh

]]>
		</scriptdata>
		<scriptdata location="/etc/rc.d/0600-teamviewer.sh" mode="0755" group="0" owner="0">
		<![CDATA[#!/bin/bash
		
#lesslinux provides teamviewer
#lesslinux license BSD

PATH=/bin:/sbin:/usr/bin:/usr/sbin:/static/bin:/static/sbin
export PATH

. /etc/rc.defaults
. /etc/rc.subr/extractbootparams
. /etc/rc.subr/colors

case $1 in 
    start)
	printf "$bold===> Preparing TeamViewer $normal\n"
	if [ -f /lesslinux/blob/teamviewer_linux.sqs ] ; then
		freeloop=` losetup -f ` 
		losetup $freeloop /lesslinux/blob/teamviewer_linux.sqs
		mount $freeloop /opt/teamviewer/teamviewer9
		mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer/teamviewer9/profile
		mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer/teamviewer9/config
		mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer/teamviewer9/logfiles
	elif [ -f /lesslinux/blob/teamviewer_linux.tar.gz ] ; then
		mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer
		tar -C /opt/teamviewer -xvzf /lesslinux/blob/teamviewer_linux.tar.gz
		chown -R root:root /opt/teamviewer
		if mountpoint -q /lesslinux/blobpart ; then
			( cd /opt/teamviewer ; mksquashfs teamviewer9 /lesslinux/blobpart/teamviewer_linux.sqs )
			ln -sf /lesslinux/blobpart/teamviewer_linux.sqs /lesslinux/blob/teamviewer_linux.sqs
			freeloop=` losetup -f ` 
			losetup $freeloop /lesslinux/blob/teamviewer_linux.sqs
			umount /opt/teamviewer
			mount $freeloop /opt/teamviewer/teamviewer9
			mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer/teamviewer9/profile
			mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer/teamviewer9/config
			mount -t tmpfs -o mode=0755 tmpfs /opt/teamviewer/teamviewer9/logfiles
		fi
	else
		mount --bind /usr/share/applications/teamviewer.desktop.missing /usr/share/applications/teamviewer.desktop
	fi
    ;;
    stop)
	printf "$bold===> Removing TeamViewer $normal\n"
	if [ -f /opt/teamviewer/teamviewer9/teamviewer ] ; then
		killall TeamViewer.exe
		killall teamviewerd
		killall -9 TeamViewer.exe
		killall -9 teamviewerd 
	fi
	umount /usr/share/applications/teamviewer.desktop
	umount /opt/teamviewer/teamviewer9/logfiles
	umount /opt/teamviewer/teamviewer9/profile
	umount /opt/teamviewer/teamviewer9/config
	umount /opt/teamviewer/teamviewer9
	umount /opt/teamviewer
	tvloop=` losetup -a | grep teamviewer | awk -F ':' '{print $1}' ` 
	[ -n "$tvloop" ] && losetup -d "$tvloop" 
    ;;
esac
		]]>
		</scriptdata>
	</scripts>
</llpackages>
